/**
 * Kik Cards
 * Copyright (c) 2012 Kik Interactive, http://kik.com
 * All rights reserved
 * http://cards.kik.com/terms.html
 *
 * classList.js: Cross-browser full element.classList implementation.
 * By Eli Grey, http://eligrey.com
 * Public Domain
 * No warranty expressed or implied. Use at your own risk.
 *
 * json2.js
 * See http://www.JSON.org/js.html
 * Public Domain
 * No warranty expressed or implied. Use at your own risk.
*/
(function(b){if(b.cards){throw Error("picard is already initialized")}var a={};a.enabled=false;a.version="0.10.0";a._={};b.cards=a})(window);(function(){if(!Object.keys){Object.keys=function(c){var b=[];for(var a in c){b.push(a)}return b}}if(!Array.isArray){Array.isArray=function(a){return Object.prototype.toString.call(a)=="[object Array]"}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,d){for(var b=d||0,a=this.length;b<a;b++){if((b in this)&&(this[b]===c)){return b}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(d,b){for(var c=0,a=this.length;c<a;c++){if(c in this){d.call(b,this[c],c,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(e,b){var a=this.length,c=new Array(a);for(var d=0;d<a;d++){if(d in this){c[d]=e.call(b,this[d],d,this)}}return c}}if(!Array.prototype.filter){Array.prototype.filter=function(e,c){var b=[];for(var f,d=0,a=this.length;d<a;d++){f=this[d];if((d in this)&&e.call(c,f,d,this)){b.push(f)}}return b}}if(!Array.prototype.reduce){Array.prototype.reduce=function(c,d){var b=0,a=this.length;if(typeof d=="undefined"){d=this[0];b=1}for(;b<a;b++){if(b in this){d=c(d,this[b],b,this)}}return d}}if(!String.prototype.trim){String.prototype.trim=function(){var a=/^\s+|\s+$/g;return function(){return String(this).replace(a,"")}}()}})();if(typeof document!=="undefined"&&!("classList" in document.createElement("a"))){(function(s){var B="classList",w="prototype",p=(s.HTMLElement||s.Element)[w],A=Object,r=String[w].trim||function(){return this.replace(/^\s+|\s+$/g,"")},z=Array[w].indexOf||function(a){var b=0,c=this.length;for(;b<c;b++){if(b in this&&this[b]===a){return b}}return -1},o=function(b,a){this.name=b;this.code=DOMException[b];this.message=a},v=function(a,b){if(b===""){throw new o("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(b)){throw new o("INVALID_CHARACTER_ERR","String contains an invalid character")}return z.call(a,b)},y=function(a){var b=r.call(a.className),c=b?b.split(/\s+/):[],d=0,e=c.length;for(;d<e;d++){this.push(c[d])}this._updateClassName=function(){a.className=this.toString()}},x=y[w]=[],t=function(){return new y(this)};o[w]=Error[w];x.item=function(a){return this[a]||null};x.contains=function(a){a+="";return v(this,a)!==-1};x.add=function(a){a+="";if(v(this,a)===-1){this.push(a);this._updateClassName()}};x.remove=function(a){a+="";var b=v(this,a);if(b!==-1){this.splice(b,1);this._updateClassName()}};x.toggle=function(a){a+="";if(v(this,a)===-1){this.add(a)}else{this.remove(a)}};x.toString=function(){return this.join(" ")};if(A.defineProperty){var q={get:t,enumerable:true,configurable:true};try{A.defineProperty(p,B,q)}catch(u){if(u.number===-2146823252){q.enumerable=false;A.defineProperty(p,B,q)}}}else{if(A[w].__defineGetter__){p.__defineGetter__(B,t)}}}(self))}(function(f,h,d){var j=false,g=[];c();d._.onLog=i;function i(k){if(typeof k!=="function"){throw TypeError("log listener must be a function, got "+k)}g.push(k)}function e(l,k){if(j){return}j=true;g.forEach(function(n){try{n(l,k)}catch(m){}});j=false}function c(){var k=f.console;if(typeof k!=="object"){k={}}k.log=b(k.log,"log");k.warn=b(k.warn,"warn");k.error=b(k.error,"error");a();f.console=k}function b(k,l){switch(typeof k){case"undefined":k=function(){};case"function":break;default:return k}return function(){var m=Array.prototype.map.call(arguments,function(n){if((typeof n==="object")&&(n!==null)&&f.JSON&&JSON.stringify){try{return JSON.stringify(n)}catch(o){}}return n+""}).join(" ");e(l,m);k.apply(this,arguments)}}function a(){if(!f.addEventListener){return}f.addEventListener("error",function(k){e("exception",k.message+"")},false)}})(window,document,cards);(function(d,a,c){var b={};c.utils=b;b.error=function(e){if(d.console&&d.console.error){if((typeof e==="object")&&e.stack){d.console.error(e.stack)}else{d.console.error(e+"")}}};b.platform={};b.platform.os=function(){var h=d.navigator.userAgent,g,f,e;if((e=/\bCPU.*OS (\d+(_\d+)?)/i.exec(h))){g="ios";f=e[1].replace("_",".")}else{if((e=/\bAndroid (\d+(\.\d+)?)/.exec(h))){g="android";f=e[1]}else{if((e=/\bWindows Phone OS (\d+(\.\d+)?)/.exec(h))){g="winphone";f=e[1]}else{if((e=/\bMac OS X (\d+(_\d+)?)/.exec(h))){g="osx";f=e[1].replace("_",".")}else{if((e=/\bWindows NT (\d+(.\d+)?)/.exec(h))){g="windows";f=e[1]}else{if((e=/\bLinux\b/.exec(h))){g="linux";f=null}else{if((e=/\b(Free|Net|Open)BSD\b/.exec(h))){g="bsd";f=null}}}}}}}var i={name:g,version:f&&d.parseFloat(f),versionString:f};i[g]=true;return i}();b.platform.browser=function(){var h=d.navigator.userAgent,g,f,e;if((e=/\bMSIE (\d+(\.\d+)?)/i.exec(h))){g="msie";f=e[1]}else{if((e=/\bOpera\/(\d+(\.\d+)?)/i.exec(h))){g="opera";f=e[1];if((e=/\bVersion\/(\d+(\.\d+)?)/i.exec(h))){f=e[1]}}else{if((e=/\bChrome\/(\d+(\.\d+)?)/i.exec(h))){g="chrome";f=e[1]}else{if((h.indexOf("Safari/")!=-1)&&(e=/\bVersion\/(\d+(\.\d+)?)/i.exec(h))){if(b.platform.os.android){g="android"}else{g="safari"}f=e[1]}else{if((e=/\bFirefox\/(\d+(\.\d+)?)/i.exec(h))){g="firefox";f=e[1]}}}}}var i={name:g,version:f&&d.parseFloat(f),versionString:f};i[g]=true;return i}();b.platform.engine=function(){var h=d.navigator.userAgent,g,f,e;if((e=/\bTrident\/(\d+(\.\d+)?)/i.exec(h))){g="trident";f=e[1]}else{if((e=/\bMSIE 7/i.exec(h))){g="trident";f="3.1"}else{if((e=/\bPresto\/(\d+(\.\d+)?)/i.exec(h))){g="presto";f=e[1]}else{if((e=/\bAppleWebKit\/(\d+(\.\d+)?)/i.exec(h))){g="webkit";f=e[1]}else{if((e=/\brv\:(\d+(\.\d+)?)/i.exec(h))){g="gecko";f=e[1]}}}}}var i={name:g,version:f&&d.parseFloat(f),versionString:f};i[g]=true;return i}();b.random={};b.random.name=function(e){return("____"+(e||"")+"____"+Math.random()).replace(/\.|\-/g,"")};b.random.num=function(){return Math.floor((Math.random()*18014398509481984)-9007199254740992)};b.random.uuid=function(){var e=36,g=new Array(e),h="0123456789abcdef",f;for(f=0;f<e;f++){g[f]=Math.floor(Math.random()*16)}g[14]=4;g[19]=(g[19]&3)|8;for(f=0;f<e;f++){g[f]=h[g[f]]}g[8]=g[13]=g[18]=g[23]="-";return g.join("")};b.enumerate=function(f){if(typeof f!=="object"){f=Array.prototype.slice.call(arguments)}var h={};for(var g=0,e=f.length;g<e;g++){h[f[g]]=g}return h};b.preloadImage=function(){var f={};return e;function e(){var h=arguments;cards.ready(function(){g.apply(b,h)})}function g(j,l){if(typeof j!="string"){b.asyncJoin(j.map(function(m){return function(n){b.preloadImage(m,n)}}),l||function(){});return}if(f[j]===true){if(l){setTimeout(function(){l(true)},0)}return}else{if(f[j]){f[j].push(l);return}}f[j]=[l];var h=false;function k(o){if(h){return}h=true;var q=f[j];f[j]=o;for(var n,p=0,m=q.length;p<m;p++){n=q[p];if(n){n(o)}}}var i=new Image();i.onload=function(){k(true)};i.onerror=function(){k(false)};i.src=j}}();b.url={};b.url.dir=function(){var e=/\/[^\/]*$/;return function(f){switch(typeof f){case"undefined":f=d.location.href;case"string":break;default:throw TypeError("url "+f+" must be string if defined")}f=((f.split("?")[0]||"").split("#")[0]||"");return f.replace(e,"/")}}();b.url.host=function(){var e=/^https?\:\/\/([^\/]+)\/.*$/;return function(g){switch(typeof g){case"undefined":return d.location.host;case"string":break;default:throw TypeError("url "+g+" must be string if defined")}var f=e.exec(g);return f&&f[1]}}();b.url.path=function(){var e=/^https?\:\/\/[^\/]+(\/.*)$/;return function(g){switch(typeof g){case"undefined":return d.location.pathname;case"string":break;default:throw TypeError("url "+g+" must be string if defined")}var f=e.exec(g);return f&&f[1]}}();b.url.dataToQuery=function(){var e=/%20/g;return function(k){var h=[],j,f,i;for(var g in k){j=k[g];if((j!==null)&&(j!==undefined)){f=encodeURIComponent(g);i=encodeURIComponent(j);h.push(f+"="+i)}}return h.join("&").replace(e,"+")}}();b.url.queryToData=function(){var f=/([^&=]+)=([^&]+)/g,e=/\+/g;return function(k){var h={},g,i,j;if(k){k=k.replace(e,"%20");while((g=f.exec(k))){i=decodeURIComponent(g[1]);j=decodeURIComponent(g[2]);h[i]=j}}return h}}();b.url.withQuery=function(e,f){if(!f){f=e;e=d.location.href}e=e.split("?")[0];var g=b.url.dataToQuery(f);if(g){e+="?"+g}return e};b.url.updateQuery=function(e,f){if(!f){f=e;e=d.location.href}var g=b.url.parseQuery(e);b.obj.extend(g,f);return b.url.withQuery(e,g)};b.url.parseQuery=function(e){e=e||d.location.href;return b.url.queryToData(e.split("?")[1])};b.url.query=b.url.parseQuery();b.jsonp=function(s){var q=false,l=function(){},h=b.random.name("PICARD_UTILS_JSONP_CALLBACK"),e=s.url,i=b.obj.copy(s.data),m=s.callbackName||"callback",p=s.callback||l,f=s.success||l,j=s.error||l,o=s.complete||l,r=a.getElementsByTagName("script")[0],k=a.createElement("script");i[m]="window."+h;k.type="text/javascript";k.async=true;k.onerror=g;k.src=b.url.updateQuery(e,i);function n(){d[h]=l;try{r.parentNode.removeChild(k)}catch(t){}}function g(){if(q){return}n();p=l;f=l;j();j=l;o();o=l}d[h]=function(){q=true;n();p.apply(this,arguments);p=l;f.apply(this,arguments);f=l;j=l;o();o=l};if(s.timeout){setTimeout(g,s.timeout)}r.parentNode.insertBefore(k,r)};b.asyncJoin=function(e,k){var g=true;if(!Array.isArray(e)){g=false;e=Array.prototype.slice.call(arguments);k=e.pop()}var f=false,j=e.length,i=new Array(j);if(j===0){h();return}e.forEach(function(m,l){setTimeout(function(){var n=false;m(function(){if(n){return}n=true;if(i[l]){return}var o=Array.prototype.slice.call(arguments);i[l]=o;j--;h()})},0)});function h(){if((j!==0)||f){return}f=true;setTimeout(function(){if(g){k.call(d,i)}else{k.apply(d,i)}},0)}};b.obj={};b.obj.extend=function(g,f){for(var e in f){val1=g[e];val2=f[e];if(val1!==val2){g[e]=val2}}return g};b.obj.copy=function(e){return b.obj.extend({},e)};b.obj.forEach=function(g,h,e){for(var f in g){h.call(e,f,g[f],g)}};b.obj.inverse=function(g){var e={};for(var f in g){e[g[f]]=f}return e};b.obj.values=function(g){var e=[];for(var f in g){e.push(g[f])}return e};b.obj.has=function(g,f){for(var e in g){if(g[e]===f){return true}}return false};b.windowReady=function(f){if(a.readyState==="complete"){setTimeout(function(){f()},0);return}d.addEventListener("load",e,false);function e(){d.removeEventListener("load",e);setTimeout(function(){f()},0)}};b.ready=function(){var g=false,f=[];function h(){if(g){return}g=true;for(var k;(k=f.shift());){try{k()}catch(j){b.error(j)}}}function e(k){try{a.documentElement.doScroll("left")}catch(j){setTimeout(function(){e(k)},1);return}if(k){k()}}function i(l){if(a.readyState==="complete"){setTimeout(l,0);return}if(a.addEventListener){a.addEventListener("DOMContentLoaded",l,false);d.addEventListener("load",l,false)}else{if(a.attachEvent){a.attachEvent("onreadystatechange",l);d.attachEvent("onload",l);var j=false;try{j=(d.frameElement===null)}catch(k){}if(a.documentElement.doScroll&&j){setTimeout(function(){e(l)},0)}}}}i(h);return function(j){if(typeof j!=="function"){throw TypeError("callback "+j+" must be a function")}if(g){setTimeout(function(){j()},0)}else{f.push(j)}}}()})(window,document,cards);(function(f,a,e){e.events=d;e.events.handlers=g;function b(){this.handlers={};this.onceHandlers={};this.globalHandlers=[];this.globalOnceHandlers=[]}b.prototype.insureNamespace=function(i){if(!this.handlers[i]){this.handlers[i]=[]}if(!this.onceHandlers[i]){this.onceHandlers[i]=[]}};b.prototype.bind=function(i,j){this.insureNamespace(i);this.handlers[i].push(j)};b.prototype.bindToAll=function(i){this.globalHandlers.push(i)};b.prototype.bindOnce=function(i,j){this.insureNamespace(i);this.onceHandlers[i].push(j)};b.prototype.bindToAllOnce=function(i){this.globalOnceHandlers.push(i)};b.prototype.unbind=function(i,j){this.insureNamespace(i);h(this.handlers[i],j);h(this.onceHandlers[i],j)};b.prototype.unbindFromAll=function(j){h(this.globalHandlers,j);h(this.globalOnceHandlers,j);for(var i in this.handlers){h(this.handlers[i],j);h(this.onceHandlers[i],j)}};b.prototype.trigger=function(j,k,i){this.insureNamespace(j);if(typeof i==="undefined"){i=this}function l(m){try{m.call(i,k,j)}catch(n){e.utils.error(n)}}this.handlers[j].forEach(l);this.globalHandlers.forEach(l);this.onceHandlers[j].forEach(l);this.globalOnceHandlers.forEach(l);this.onceHandlers[j].splice(0);this.globalOnceHandlers.splice(0)};function h(j,l){for(var k=j.length;k--;){if(j[k]===l){j.splice(k,1)}}}function d(j){if(typeof j==="undefined"){j={}}var i=new b();j.on=function(k,l){if(Array.isArray(k)){k.forEach(function(m){j.on(m,l)});return}if(typeof l==="undefined"){l=k;k=""}if(typeof k!=="string"){throw TypeError("name "+k+" must be a string")}if(typeof l!=="function"){throw TypeError("handler "+l+" must be a function")}if(k){i.bind(k,l)}else{i.bindToAll(l)}};j.off=function(k,l){if(Array.isArray(k)){k.forEach(function(m){j.off(m,l)});return}if(typeof l==="undefined"){l=k;k=""}if(typeof k!=="string"){throw TypeError("name "+k+" must be a string")}if(typeof l!=="function"){throw TypeError("handler "+l+" must be a function")}if(k){i.unbind(k,l)}else{i.unbindFromAll(l)}};j.once=function(k,l){if(Array.isArray(k)){k.forEach(function(m){j.once(m,l)});return}if(typeof l==="undefined"){l=k;k=""}if(typeof k!=="string"){throw TypeError("name "+k+" must be a string")}if(typeof l!=="function"){throw TypeError("handler "+l+" must be a function")}if(k){i.bindOnce(k,l)}else{i.bindToAllOnce(l)}};j.trigger=function(l,m,k){if(Array.isArray(l)){l.forEach(function(n){j.trigger(n,m,k)});return}if(typeof l!=="string"){throw TypeError("name "+l+" must be a string")}i.trigger(l,m,k)};return j}function c(){this.handlers=[];this.events=[]}c.prototype.addHandler=function(i){this.handlers.push(i);return this.processEvents()};c.prototype.triggerEvent=function(i){this.events.push(i);this.processEvents()};c.prototype.triggerEvents=function(i){this.events=this.events.concat(i);this.processEvents()};c.prototype.processEvents=function(){if(!this.events.length||!this.handlers.length){return}var j=this.events.splice(0),i=this.handlers;j.forEach(function(k){i.forEach(function(l){l(k)})});return true};function g(){var i=new c();return{handler:function(j){return i.addHandler(j)},trigger:function(j){i.triggerEvent(j)},triggerMulti:function(j){i.triggerEvents(j)}}}})(window,document,cards);cards.ready=function(d,e){var b=[];a();return c;function c(g){if(b){b.push(g)}else{f(g)}}function a(){e.utils.windowReady(function(){setTimeout(function(){var g=b.slice();b=null;g.forEach(f)},3)})}function f(h){try{h()}catch(g){e.utils.error(g)}}}(window,cards);cards.open=function(c,f){var e=f.utils.platform.os,a=f.utils.platform.browser;c.open=function(g){d(g)};d.card=b;return d;function d(i,h){if(typeof i!=="string"){throw TypeError("url must be a string, got "+i)}switch(typeof h){case"object":h=JSON.stringify(h);case"undefined":case"string":break;default:throw TypeError("linkData must be a string of JSON if defined, got "+h)}if(f.browser&&f.browser.open){f.browser.open(i,h);return}if(h){i=i.split("#")[0]+"#"+encodeURIComponent(h)}var g=i.substr(0,7)==="card://",j=i.substr(0,8)==="cards://";if(!g&&!j){c.location.href=i;return}b(i,"http"+i.substr(4))}function b(h,g){if(!e.ios&&!e.android){if(g){c.location.href=g}return}if(e.ios||a.chrome){if(g){setTimeout(function(){if(!document.webkitHidden){c.location.href=g}},e.ios?25:1000)}c.location.href=h;return}var j;if(g){j=setTimeout(function(){c.location=g},1000)}var i=document.createElement("iframe");i.style.position="fixed";i.style.top="0";i.style.left="0";i.style.width="1px";i.style.height="1px";i.style.border="none";i.style.opacity="0";i.onload=function(){if(g){clearTimeout(j)}try{document.documentElement.removeChild(i)}catch(k){}};i.src=h;document.documentElement.appendChild(i)}}(window,cards);(function(window,document,picard){var BRIDGE_SIGNAL_URL=window.location.protocol+"//cardsbridge.kik.com/",PLUGIN_REQUEST_BATCH="batch-call",PLUGIN_REQUEST_NAME="requestPlugin",PLUGIN_REQUEST_VERSION="requestVersion",PLUGIN_LOG="log";var plugins={},os=picard.utils.platform.os,androidBridge=window.CardsBridge;function validateBridge(){if(os.android){return validateAndroidBridge()}else{if(os.ios){return validateIPhoneBridge()}else{return false}}}function validateAndroidBridge(){if(!androidBridge){return false}if(typeof androidBridge.invokeFunction!=="function"){return false}if(typeof androidBridge.poll!=="function"){return false}return makeBridgeCall(PLUGIN_REQUEST_VERSION).data}function validateIPhoneBridge(){var bridgeInfo;try{bridgeInfo=makeBridgeCall(PLUGIN_REQUEST_VERSION).data}catch(err){}return bridgeInfo?bridgeInfo:false}function sendIFrameSignal(bridgeFunctionName,argData,asyncCallbackName){var callbackName=picard.utils.random.name("PICARD_BRIDGE_CALLBACK"),status,data;window[callbackName]=function(callbackStatus,callbackData){delete window[callbackName];status=callbackStatus;data=callbackData};var url=BRIDGE_SIGNAL_URL+bridgeFunctionName+"/"+callbackName+"?args="+encodeURIComponent(argData)+"&async="+(asyncCallbackName||"");var doc=document.documentElement,iframe=document.createElement("iframe");iframe.style.display="none";iframe.src=url;doc.appendChild(iframe);doc.removeChild(iframe);if(window[callbackName]){delete window[callbackName];throw Error("bridge call "+bridgeFunctionName+" failed to return")}return{status:status,data:data}}function sendBatchIFrameSignal(urls){var calls=urls.map(function(url){return encodeURIComponent(url)}).join(",");var url=BRIDGE_SIGNAL_URL+PLUGIN_REQUEST_BATCH+"?calls="+calls;var doc=document.documentElement,iframe=document.createElement("iframe");iframe.style.display="none";iframe.src=url;doc.appendChild(iframe);doc.removeChild(iframe)}function androidBridgeCall(bridgeFunctionName,argData,asyncCallbackName){var response,result;if(!asyncCallbackName){response=androidBridge.invokeFunction(bridgeFunctionName,argData)}else{if(androidBridge.invokeAsyncFunction){response=androidBridge.invokeAsyncFunction(bridgeFunctionName,argData,asyncCallbackName)}else{throw TypeError("bridge: android bridge does not support async callbacks")}}try{result=JSON.parse(response)}catch(err){throw TypeError("bridge call for "+bridgeFunctionName+" responded with invalid JSON")}return{status:result.status,data:result.data}}function makeBridgeCall(bridgeFunctionName,args,asyncCallback){if(typeof bridgeFunctionName!=="string"){throw TypeError("bridge call "+bridgeFunctionName+" must be a string")}switch(typeof args){case"function":asyncCallback=args;args=undefined;case"undefined":args={};case"object":break;default:throw TypeError("bridge call arguments "+args+" must be a JSON object if specified")}switch(typeof asyncCallback){case"undefined":case"function":break;default:throw TypeError("bridge async callback must be a function if defined, got "+asyncCallback)}var argData;try{argData=JSON.stringify(args)}catch(err){throw TypeError("bridge call arguments "+args+" must be a JSON object")}var asyncCallbackName;if(asyncCallback){asyncCallbackName=setupAsyncCallback(asyncCallback)}var result;if(androidBridge){result=androidBridgeCall(bridgeFunctionName,argData,asyncCallbackName)}else{result=sendIFrameSignal(bridgeFunctionName,argData,asyncCallbackName)}if(asyncCallbackName&&(!result||!result.status||(result.status!==202))){delete window[asyncCallbackName]}return result}function setupAsyncCallback(asyncCallback){var callbackName=picard.utils.random.name("PICARD_BRIDGE_ASYNC_CALLBACK");window[callbackName]=function(status,data){delete window[callbackName];if(androidBridge){try{var response=JSON.parse(status);status=response.status;data=response.data}catch(err){throw Error("bridge failed to parse android async data, "+status)}}if((typeof data!=="object")||(data===null)){asyncCallback()}else{if(!status||(status<200)||(status>=300)){asyncCallback()}else{asyncCallback(data)}}};return callbackName}function setupEventCallback(eventCallback){var callbackName=picard.utils.random.name("PICARD_BRIDGE_EVENT_CALLBACK");window[callbackName]=function(name,data){if(androidBridge){try{data=JSON.parse(data)}catch(err){throw Error("bridge failed to parse android event data, "+data)}}eventCallback(name,data)};return callbackName}function setupAndroidPoll(){window.addEventListener("keyup",function(e){if(e.which!==0){return}performAndroidPoll();return false})}function performAndroidPoll(){var code=androidBridge.poll()+"";if(!code){return}try{eval(code)}catch(err){if(window.console&&window.console.error){window.console.error("android poll failed to evaluate "+code+", "+err)}}performAndroidPoll()}function setupIOSLogging(){picard._.onLog(function(level,message){makeBridgeCall(PLUGIN_LOG,{level:level,message:message})})}function bridgeFunctionCall(bridgeFunctionName,args,callback){var data=makeBridgeCall(bridgeFunctionName,args,callback);if(!data){throw Error("bridge call "+bridgeFunctionName+" did not return")}if(!data.status||(data.status<200)||(data.status>=300)){throw Error("bridge call "+bridgeFunctionName+" did not complete successfully, "+data.status)}if(typeof data.data!=="object"){throw TypeError("bridge call "+bridgeFunctionName+" did not return an object, "+data.data)}return data.data}function setupFunction(bridgeFunctionName){return function(args,callback){return bridgeFunctionCall(bridgeFunctionName,args,callback)}}function setupFunctions(namespace,functionNames,pluginObj){if(!Array.isArray(functionNames)){throw TypeError("functions "+functionNames+" must be an array")}if(typeof pluginObj==="undefined"){pluginObj={}}functionNames.forEach(function(functionName){if(typeof functionName!=="string"){throw TypeError("function "+functionName+" must be a string")}pluginObj[functionName]=setupFunction(namespace+"."+functionName)})}function setupPlugin(pluginName){var pluginObj=picard.events(),pluginData=makeBridgeCall(PLUGIN_REQUEST_NAME,{name:pluginName,eventCallback:setupEventCallback(pluginObj.trigger)});if(pluginData.status!==200){throw TypeError("plugin "+pluginName+" failed to initialize")}setupFunctions(pluginName,pluginData.data.functions,pluginObj);return pluginObj}function bridge(pluginName){if(typeof pluginName!=="string"){throw TypeError("plugin name must be a string, got "+pluginName)}if(!plugins[pluginName]){var plugin=setupPlugin(pluginName);plugins[pluginName]=plugin}return plugins[pluginName]}function batchRequest(calls){if(!Array.isArray(calls)){throw TypeError("batch calls must be an array, got "+calls)}calls.forEach(function(data){if(typeof data!=="object"){throw TypeError("batch call must be an object, got "+data)}if(typeof data.name!=="string"){throw TypeError("batch call name must be a string, got "+data.name)}switch(typeof data.args){case"undefined":case"object":break;default:throw TypeError("batch call args must be an object if defined, got "+data.args)}switch(typeof data.callback){case"function":case"undefined":break;default:throw TypeError("batch call callback must be a function if defined, got "+data.callback)}});if(androidBridge){return calls.map(function(data){try{if(data.name.indexOf(".")===-1){return bridge(data.name)}else{return bridgeFunctionCall(data.name,data.args,data.callback)}}catch(err){}})}var batchCalls=[],responses=new Array(calls.length);calls.forEach(function(data,index){var isPluginRequest=(data.name.indexOf(".")===-1);if(!isPluginRequest){batchCalls.push(generateBatchSegment(data,function(responseData){responses[index]=responseData}))}else{if(plugins[data.name]){responses[index]=plugins[data.name]}else{batchCalls.push(generatePluginBatchSegment(data,function(responseData){responses[index]=responseData}))}}});sendBatchIFrameSignal(batchCalls);return responses}function generateBatchSegment(data,callback){var argData=JSON.stringify(data.args);var asyncCallbackName;if(data.callback){asyncCallbackName=setupAsyncCallback(data.callback)}var callbackName=picard.utils.random.name("PICARD_BRIDGE_CALLBACK");setTimeout(function(){delete window[callbackName]},0);window[callbackName]=function(callbackStatus,callbackData){delete window[callbackName];if(asyncCallbackName&&callbackStatus!==202){delete window[asyncCallbackName]}if(callbackStatus>=200&&callbackStatus<300){callback(callbackData)}};var url=BRIDGE_SIGNAL_URL+data.name+"/"+callbackName+"?args="+encodeURIComponent(argData)+"&async="+(asyncCallbackName||"");return url}function generatePluginBatchSegment(data,callback){var pluginObj=picard.events(),argData=JSON.stringify({name:data.name,eventCallback:setupEventCallback(pluginObj.trigger)});var callbackName=picard.utils.random.name("PICARD_BRIDGE_CALLBACK");setTimeout(function(){delete window[callbackName]},0);window[callbackName]=function(callbackStatus,callbackData){delete window[callbackName];if(callbackStatus===200){setupFunctions(data.name,callbackData.functions,pluginObj);plugins[data.name]=pluginObj;callback(pluginObj)}};var url=BRIDGE_SIGNAL_URL+PLUGIN_REQUEST_NAME+"/"+callbackName+"?args="+encodeURIComponent(argData)+"&async=";return url}function redirectToCards(){var os=picard.utils.platform.os,urllib=picard.utils.url;if(!urllib.query.kikme||(!os.ios&&!os.android)){return}try{var iframe=document.createElement("iframe");iframe.src="card"+urllib.updateQuery({kikme:null}).substr(4);iframe.style.display="none";var cleanup=function(){try{document.documentElement.removeChild(iframe)}catch(err){}};iframe.onload=cleanup;iframe.onerror=cleanup;setTimeout(cleanup,1000);document.documentElement.appendChild(iframe)}catch(err){}}function main(){var bridgeInfo=validateBridge();if(!bridgeInfo){redirectToCards();return}picard._.bridge=bridge;picard._.bridge.batch=batchRequest;if(androidBridge){setupAndroidPoll();picard._.bridge.forceAndroidPoll=performAndroidPoll}else{setupIOSLogging()}picard.enabled=true;bridge.info=bridgeInfo;bridge.version=bridgeInfo.version;picard.utils.platform.browser.name="cards";picard.utils.platform.browser.cards=true;picard.utils.platform.browser.version=window.parseFloat(bridge.version);picard.utils.platform.browser.versionString=bridge.version}main()})(window,document,cards);(function(d){var b={};d._.firstBatch=b;if(!d._.bridge||!d.utils.platform.os.ios||(d.utils.platform.browser.version<6.5)){return}var a=[{name:"Metrics"},{name:"Browser"},{name:"Media"},{name:"Kik"},{name:"Profile"},{name:"UserData"},{name:"Auth"},{name:"Photo"},{name:"Keyboard"},{name:"Push"},{name:"Picker"}];var c=[{name:"Browser.getLastLinkData",args:{}},{name:"Kik.getLastMessage",args:{}},{name:"Push.getNotificationList",args:{}},{name:"Push.setBadgeVisibility",args:{visible:false}},{name:"Picker.getRequest",args:{}}];d._.bridge.batch(a.concat(c)).slice(a.length).forEach(function(e,g){var f=c[g];b[f.name]=e;if(!e){}else{if(!d._.secondBatch){d._.secondBatch=[]}}})})(cards);(function(b,g){var c="kik-transform-fix";if(a()){d()}function a(){var h=true;if(!g.enabled){h=false}else{if(!g.utils.platform.os.android){h=false}else{Array.prototype.forEach.call(b.getElementsByTagName("meta"),function(i){if((i.name===c)&&(i.content==="false")){h=false}})}}return h}function d(){var h=b.documentElement;e(h,"translate3d(0,0,0)");setTimeout(function(){f(h,"transform 10ms linear");setTimeout(function(){e(h,"translate3d(0,0,1px)");setTimeout(function(){f(h,"");setTimeout(function(){e(h,"")},0)},10)},0)},0)}function e(i,h){i.style["-webkit-transform"]=h;i.style["-moz-transform"]=h;i.style["-ms-transform"]=h;i.style["-o-transform"]=h;i.style.transform=h}function f(h,i){if(i){h.style["-webkit-transition"]="-webkit-"+i;h.style["-moz-transition"]="-moz-"+i;h.style["-ms-transition"]="-ms-"+i;h.style["-o-transition"]="-o-"+i;h.style.transition=i}else{h.style["-webkit-transition"]="";h.style["-moz-transition"]="";h.style["-ms-transition"]="";h.style["-o-transition"]="";h.style.transition=""}}})(document,cards);(function(e,d){var c;try{c=d._.bridge("Metrics")}catch(b){}var f=d.events();d.metrics=f;f.loadTime=null;f.coverTime=null;if(c){c.on("loadData",function(j){if(typeof j.loadTime==="number"){f.loadTime=j.loadTime;f.trigger("loadTime",j.loadTime)}if(typeof j.coverTime==="number"){f.coverTime=j.coverTime;f.trigger("coverTime",j.coverTime)}})}var i=false;f.enableGoogleAnalytics=h;f.googleAnalyticsEvent=g;function h(){if(i){return}i=true;if(c){a("loadTime");a("coverTime")}if(cards.kik&&cards.kik.hasPermission){var j;try{j=cards.kik.hasPermission()}catch(k){}if(typeof j==="boolean"){g("linked",j?1:0)}}}function g(k,j,l){switch(typeof j){case"number":l=j;j=undefined;case"undefined":case"string":break;default:return false}switch(typeof l){case"number":l=Math.floor(l);case"undefined":break;default:return false}if((typeof j==="undefined")&&(typeof l==="undefined")){return false}if(!e._gaq){e._gaq=[]}if(!e._gaq.push){return false}e._gaq.push(["_trackEvent","Cards",k,j,l,true]);return true}function a(j){g(j,f[j]);f.on(j,function(){g(j,f[j])})}})(window,cards);(function(h,n,m){function p(x,B){var w=h.applicationCache,A=false;if(!w||!w.addEventListener||!w.swapCache||!w.update){B(false);return}if(w.status===w.UPDATEREADY){v();return}if((w.status!==w.IDLE)&&(w.status!==w.CHECKING)&&(w.status!==w.DOWNLOADING)){B(false);return}w.addEventListener("noupdate",y,false);w.addEventListener("updateready",v,false);w.addEventListener("error",v,false);w.addEventListener("obsolete",v,false);setTimeout(v,30*1000);if(w.status===w.IDLE){try{w.update()}catch(z){v()}}function y(){if(A){return}A=true;if(!x&&h.console&&h.console.log){h.console.log("refresh requested but no update to manifest found");h.console.log("** update your manifest to see changes reflected")}setTimeout(function(){B(true)},1000)}function v(){if(A){return}A=true;var C=false;if(w.status===w.UPDATEREADY){try{w.swapCache();C=true}catch(D){}}B(C)}}if(m.utils.platform.os.ios){setTimeout(function(){p(true,function(v){})},5000)}h.ZERVER_REFRESH=function(){p(true,function(){h.location.reload()})};function g(x){if(typeof x!=="string"){return undefined}x=decodeURIComponent(x);var v;try{v=JSON.parse(x)}catch(w){}if((typeof v==="object")&&(v!==null)){return v}else{return x||undefined}}if(h.location.hash){m.linkData=g(h.location.hash.substr(1))}var a;try{a=m._.bridge("Browser")}catch(c){return}var t=m.events();m.browser=t;var u={};if(a.setCardInfo){var k=/(^|\s)icon(\s|$)/i,r,f;Array.prototype.forEach.call(n.getElementsByTagName("link"),function(v){if(!r){if((v.rel==="kik-icon")||(k.test(v.rel)&&!r)){r=v.href}}if(!f){if(v.rel==="kik-tray-icon"){f=v.href}}});var j={title:n.title,icon:r,mediaTrayIcon:f};if(cards._.secondBatch){cards._.secondBatch.push({name:"Browser.setCardInfo",args:j})}else{a.setCardInfo(j)}}if(a.pageLoaded){m.utils.windowReady(function(){if(n.body){var v=n.body.offsetWidth;(function(w){return w})(v)}setTimeout(function(){a.pageLoaded()},1)})}h.addEventListener("beforeunload",function(v){v.preventDefault();return false},false);h.addEventListener("unload",function(){if(a.navigationAttempted){a.navigationAttempted()}},false);if(a.setStatusBarVisible){var i=false;t.statusBar=function(v){i=true;a.setStatusBarVisible({visible:!!v})}}if(a.getOrientationLock&&a.setOrientationLock){t.getOrientationLock=function(){var v=a.getOrientationLock().position;return(v==="free")?null:v};t.setOrientationLock=function(v){switch(v){case"free":case"portrait":case"landscape":break;default:if(!v){v="free";break}throw TypeError("if defined, position "+v+' must be one of "free", "portrait", or "landscape"')}try{a.setOrientationLock({position:v});if(!i&&a.setStatusBarVisible){a.setStatusBarVisible({visible:(v!=="landscape")})}return true}catch(w){return false}}}a.on("orientationChanged",function(){if(h.App&&h.App._layout){try{h.App._layout()}catch(v){}}});if(a.setBacklightTimeoutEnabled){t.backlightTimeout=function(v){a.setBacklightTimeoutEnabled({enabled:!!v})}}if(a.forceRepaint){t.paint=function(){if(n.body){var v=n.body.offsetWidth;(function(w){return w})(v)}a.forceRepaint()}}if(a.handleBack){var d=[];t.back=function(v){if(typeof v!=="function"){throw TypeError("back handler "+v+" must be a function")}d.push(v)};t.unbindBack=function(w){if(typeof w!=="function"){throw TypeError("back handler "+w+" must be a function")}for(var v=d.length;v--;){if(d[v]===w){d.splice(v,1)}}};a.on("back",function(y){var w=false;for(var v=d.length;v--;){try{if(d[v]()===false){w=true;break}}catch(x){m.utils.error(x)}}a.handleBack({requestToken:y.requestToken,override:w})});t.back(function(){if(h.App&&(typeof h.App.back==="function")){try{if(App.back()!==false){return false}}catch(v){}}})}if(a.refresh&&a.refreshPlanned){t.refresh=function(){var v=h.applicationCache;if(!v||(v.status===v.UNCACHED)){a.refresh({withCache:false});return}p(false,function(w){a.refresh({withCache:true})})};a.on("refresh",function(){setTimeout(function(){a.refreshPlanned();t.refresh()},0)});h.ZERVER_REFRESH=function(){t.refresh()}}if(a.openCard&&a.openExternal){t.open=function(x,w,y){if(typeof x!=="string"){throw TypeError("url "+x+" must be a string")}switch(typeof w){case"undefined":case"string":break;case"object":w=JSON.stringify(w);break;default:throw TypeError("card linkData must be a string or JSON if defined, got "+w)}switch(typeof y){case"undefined":y={};break;case"object":break;default:throw TypeError("card data must be an object if defined, got "+y)}var v=x.substr(0,7)==="card://",z=x.substr(0,8)==="cards://";if(!v&&!z){a.openExternal({url:x});return}x="http"+x.substr(4);if(w){x=x.split("#")[0]+"#"+encodeURIComponent(w)}a.openCard({url:x,title:y.title||undefined,icon:y.icon||undefined,clearHistory:!!y.clearHistory})}}function o(w,v){t.linkData=g(w&&w.data);m.linkData=t.linkData;if((v!==false)&&t.linkData){t.trigger("linkData",t.linkData)}}t._processLinkData=o;if(a.getLastLinkData){o(cards._.firstBatch["Browser.getLastLinkData"]||a.getLastLinkData(),false)}a.on("linkData",o);var l=true,s=false,q=true;t.background=l;a.on("pause",function(v){s=true;e()});a.on("unpause",function(v){s=false;e()});a.on("conceal",function(v){q=true;e()});a.on("reveal",function(v){q=false;e()});function b(){return s||q}function e(){var v=l;l=b();t.background=l;if(v!==l){t.trigger(l?"background":"foreground")}}})(window,document,cards);(function(c,a,b){if(b._.bridge){c.alert=function(){};c.confirm=function(){};c.prompt=function(){}}})(window,document,cards);(function(g,c,f){var d;try{d=f._.bridge("Media")}catch(e){}if(!d||!d.setMediaCategory||!d.unsetMediaCategory){f._mediaEnabled=function(){}}else{f._mediaEnabled=a;b()}function b(){var h=false;Array.prototype.forEach.call(c.getElementsByTagName("meta"),function(i){if((i.name==="kik-media-enabled")&&(i.content==="true")){h=true}});a(h)}function a(h){if(cards._.secondBatch){cards._.secondBatch.push({name:"Media."+(h?"":"un")+"setMediaCategory",args:{}})}else{try{if(h){d.setMediaCategory()}else{d.unsetMediaCategory()}}catch(i){}}}})(window,document,cards);(function(j,k,i){var c;try{c=i._.bridge("Kik")}catch(f){return}var b=i.events();i.kik=b;b._formatMessage=e;function e(n){var l;if(typeof n!=="object"){throw TypeError("message "+n+" must be an object")}switch(typeof n.big){case"undefined":case"boolean":break;default:throw TypeError("message size (big) "+n.big+" must be a boolean if defined")}switch(typeof n.title){case"undefined":case"string":if(!n.big&&!n.title){throw TypeError("message title must be a string")}n.title=n.title||"";break;default:throw TypeError("message title "+n.title+" must be a string")}switch(typeof n.text){case"string":case"undefined":break;default:throw TypeError("message text "+n.text+" must be a string")}switch(typeof n.pic){case"undefined":case"string":break;default:throw TypeError("message pic "+n.pic+" must be a string if defined")}switch(typeof n.noForward){case"undefined":case"boolean":break;default:throw TypeError("message noForward flag must be a boolean if defined, got "+n.noForward)}switch(typeof n.fallback){case"undefined":case"string":break;default:throw TypeError("message fallback URL must be a string if defined, got "+n.fallback)}switch(typeof n.linkData){case"undefined":case"string":break;case"object":try{l=JSON.stringify(n.linkData)}catch(m){throw TypeError("message linkData must be a string or JSON if defined, got "+n.linkData)}break;default:throw TypeError("message linkData must be a string or JSON if defined, got "+n.linkData)}var o=l||n.linkData;if(typeof o==="string"){o=encodeURIComponent(o)}var l;switch(typeof n.data){case"object":if(n.data!==null){try{l=JSON.stringify(n.data)}catch(m){throw TypeError("message data must be a json object if defined, got "+n.data)}}case"undefined":break;default:throw TypeError("message data must be a json object if defined, got "+n.data)}return{title:n.title,text:n.text,image:n.pic,forwardable:!n.noForward,fallbackUrl:n.fallback,layout:n.big?"photo":"article",extras:{linkData:o||"",jsonData:l||""}}}b.send=function(m,l){if(typeof m!=="string"){l=m;m=undefined}l=e(l);l.targetUser=m;if(m&&c.sendKikToUser){c.sendKikToUser(l)}else{c.sendKik(l)}};var h=i.events.handlers();b.handler=function(l){return h.handler(l)};function g(o,l){a();if(o.extras.jsonData){var m;try{m=JSON.parse(o.extras.jsonData)}catch(n){}if((typeof m==="object")&&(m!==null)){b.message=m;h.trigger(m);b.trigger("message",m)}}if(o.extras&&o.extras.linkData&&i.browser&&i.browser._processLinkData){i.browser._processLinkData({data:o.extras.linkData},l)}}if(c.getLastMessage){var d=cards._.firstBatch["Kik.getLastMessage"]||c.getLastMessage();if(d&&d.message){g(d.message,false)}}c.on("message",g);if(c.openConversation){b.open=function(){c.openConversation()}}function a(){if(!c.openConversation){return}b.returnToConversation=function(l){b.returnToConversation=null;if(!l){c.openConversation({returnToSender:true});return}l=e(l);l.returnToSender=true;c.sendKik(l)}}})(window,document,cards);(function(f,a,e){var b;try{b=e._.bridge("Profile")}catch(d){return}var c=e.kik;if(!c){c=e.events();e.kik=c}if(b.openProfile){c.showProfile=function(h){if(typeof h!=="string"){throw TypeError("username must be a string, got "+h)}try{b.openProfile({username:h})}catch(g){}}}})(window,document,cards);(function(i,j,g){var l;try{l=g._.bridge("UserData")}catch(d){return}var b=g.kik;if(!b){b=g.events();g.kik=b}function k(m){m.fullName=(m.displayName||"");var n=m.fullName.indexOf(" ");if(n===-1){m.firstName=m.fullName;m.lastName=""}else{m.firstName=m.fullName.substr(0,n);m.lastName=m.fullName.substr(n+1)}delete m.displayName;m.pic=e(m.pic);m.thumbnail=e(m.thumbnail);return m}function e(m){if(typeof m!=="string"){return m}var n=m.replace(/^https?\:\/\/[^\/]*/,"");return"//d33vud085sp3wg.cloudfront.net"+n}var f;if(l.getUserData){b.getUser=function(m){switch(typeof m){case"undefined":m=function(){};case"function":break;default:throw TypeError("callback must be a function if defined, got "+m)}h(m)}}function h(n){if(f){setTimeout(function(){n(f)},0);return}var m=b.hasPermission?b.hasPermission():false;l.getUserData({fields:["profile"]},function(p){var o=p&&p.userData;if(!m){g.metrics.googleAnalyticsEvent("link-request",(o?1:0))}if(!o){n();return}k(o);f=o;n(o)})}if(l.checkPermissions){b.hasPermission=function(){try{return !!l.checkPermissions({fields:["profile"]}).permitted}catch(m){return false}}}if(l.pickUsers||l.pickFilteredUsers){b.pickUsers=function(m,n){switch(typeof m){case"function":n=m;case"undefined":m={};case"object":break;default:throw TypeError("options must be an object if defined, got "+m)}if(typeof n!=="function"){throw TypeError("callback must be a function, got "+n)}switch(typeof m.preselected){case"undefined":m.preselected=[];break;default:if(!Array.isArray(m.preselected)){throw TypeError("preselected users must be an array of users if defined, got "+m.preselected)}m.preselected.forEach(function(o){if(typeof o!=="object"){throw TypeError("user must be an object, got "+o)}if(typeof o.username!=="string"){throw TypeError("user.username must be a string, got "+o.username)}});break}switch(typeof m.filtered){case"undefined":m.filtered=[];break;default:if(!Array.isArray(m.filtered)){throw TypeError("filtered users must be an array of users if defined, got "+m.filtered)}m.filtered=m.filtered.map(function(o){switch(typeof o){case"string":return o;case"object":if(typeof o.username==="string"){return o.username}default:throw TypeError("filtered user didnt have a username, got "+o)}});break}switch(typeof m.filterSelf){case"undefined":case"boolean":break;default:throw TypeError("filterSelf must be a boolean if defined, got "+m.filterSelf)}switch(typeof m.minResults){case"undefined":break;case"number":if(m.minResults<0){throw TypeError("minResults must be non-negative if defined, got "+m.minResults)}break;default:throw TypeError("minResults must be a number if defined, got "+m.minResults)}switch(typeof m.maxResults){case"undefined":break;case"number":if(m.maxResults<1){throw TypeError("maxResults must be greater than 1 if defined, got "+m.maxResults)}break;default:throw TypeError("maxResults must be a number if defined, got "+m.maxResults)}switch(typeof n){case"undefined":n=function(){};break;case"function":break;default:throw TypeError("callback must be a function if defined, got "+n)}if(m.preselected.length&&m.filtered.length){throw TypeError("can only preselect or filter users, not both")}if(l.pickFilteredUsers&&!m.preselected.length){c(m,n)}else{a(m,n)}}}function c(m,n){m.minResults=m.minResults||1;l.pickFilteredUsers({minResults:m.minResults,maxResults:m.maxResults,filtered:m.filtered,filterSelf:m.filterSelf},function(o){if(!o||!o.userDataList){n();return}var p=o.userDataList.map(k);if(m.filtered){p=p.filter(function(q){return m.filtered.indexOf(q.username)===-1})}n(p)})}function a(n,p){if(!n.preselected||!n.preselected.length){n.minResults=n.minResults||1}var m={},o=[];n.preselected.forEach(function(q){m[q.username]=q;o.push(q.username)});l.pickUsers({minResults:n.minResults,maxResults:n.maxResults,preselected:o},function(q){if(!q||!q.userDataList){p();return}var r=q.userDataList.map(function(s){if(s.username in m){return m[s.username]}else{return k(s)}});p(r)})}})(window,document,cards);(function(f,a,e){var b;try{b=e._.bridge("Auth")}catch(d){return}var c=e.kik;if(!c){c=e.events();e.kik=c}if(b.signRequest){c.sign=function(g,h){b.signRequest({request:g},function(i){if(!i||!i.signedRequest){h();return}h(i.signedRequest,i.username,(i.host||f.location.host))})}}})(window,document,cards);(function(f,h,d){var i;try{i=d._.bridge("Photo")}catch(b){return}var a=d.events();d.photo=a;if(i.getPhoto){a.get=function(j,k){e(j,k)};a.getFromCamera=function(j,k){e("camera",j,k)};a.getFromGallery=function(j,k){e("gallery",j,k)}}function c(j,k){switch(typeof k){case"undefined":case"function":break;default:throw TypeError(j+" must be a number if defined, got "+k)}}function g(j,l,k,m){switch(typeof l){case"undefined":break;case"number":if(l<k||l>m){throw TypeError(j+" must be within "+k+" and "+m+" if defined, got "+l)}break;default:throw TypeError(j+" must be a number if defined, got "+l)}}function e(j,x,w){if(typeof j!=="string"){w=x;x=j;j=undefined}switch(typeof x){case"function":w=x;x={};case"object":break;default:throw TypeError("options must be an object, got "+x)}c("callback",w);c("onCancel",x.onCancel);c("onSelect",x.onSelect);c("onPhoto",x.onPhoto);c("onComplete",x.onComplete);g("quality",x.quality,0,1);g("minResults",x.minResults,0,25);g("maxResults",x.maxResults,1,25);g("maxHeight",x.maxHeight,0,1280);g("maxWidth",x.maxWidth,0,1280);var q=x.onSelect,s=x.onCancel,u=x.onPhoto,l=x.onComplete,r=false,p,t;try{i.getPhoto({source:j,quality:x.quality,minResults:x.minResults,maxResults:x.maxResults,maxHeight:x.maxHeight,maxWidth:x.maxWidth},n)}catch(m){if(!r){r=true;o(s);o(w)}}function n(y){if(r){return}r=true;p=y&&y.photoIds;var z=p&&p.length;if(!z){o(s);o(w);return}o(q,z);t=new Array(z);i.on("photo",v)}function v(C){if(!C){return}var A=p.indexOf(C.id);if(A===-1){return}C.url=C.url||null;p[A]=null;t[A]=C.url;var z=0;for(var B=0,y=p.length;B<y;B++){if(p[B]!==null){z++}}o(u,C.url,A);if(z===0){k()}}function k(){i.off("photo",v);o(l,t);o(w,t)}function o(B,z,y){if(!B){return}try{B(z,y)}catch(A){d.utils.error(A)}}}if(i.savePhoto){a.saveToGallery=function(j,m){switch(typeof m){case"undefined":m=function(){};case"function":break;default:throw TypeError("callback must be a function, got "+m)}try{i.savePhoto({url:j},function(n){k(!!n)})}catch(l){k(false)}function k(n){k=function(){};m(n)}}}})(window,document,cards);(function(j,k,h){var a;try{a=h._.bridge("Keyboard")}catch(e){}var l="kik-hide-form-helpers";var g=false;i();h.formHelpers={show:f,hide:d,isEnabled:b};function i(){var m;Array.prototype.forEach.call(k.getElementsByTagName("meta"),function(n){if(n.name===l){m=(n.content||"").trim()}});if(m==="true"){c(false);g=true}}function d(){c(false)}function f(){c(true)}function c(m){if(g){return}if(cards._.secondBatch){cards._.secondBatch.push({name:"Keyboard.setFormHelpers",args:{enabled:m}})}else{try{a.setFormNavigationEnabled({enabled:m})}catch(n){}}}function b(){try{return !!a.isFormNavigationEnabled().enabled}catch(m){return !!h.utils.platform.os.ios}}})(window,document,cards);(function(g,b,h){var a;try{a=h._.bridge("Push")}catch(f){return}var c=h.events();h.push=c;if(a.setBadgeVisibility){c.badge=function(i){a.setBadgeVisibility({visible:!!i})}}if(a.getPushToken){c.getToken=function(i){if(typeof i!=="function"){throw TypeError("callback must be a function, got "+i)}a.getPushToken(function(j){i(j&&j.token)})}}if(a.getNotificationList){var d=h.events.handlers();var e=function(){var o;try{if(h._.firstBatch&&h._.firstBatch["Push.getNotificationList"]){o=h._.firstBatch["Push.getNotificationList"]}else{o=a.getNotificationList()}}catch(n){}if(a.setBadgeVisibility&&!(h._.firstBatch&&h._.firstBatch["Push.setBadgeVisibility"])){try{a.setBadgeVisibility({visible:false})}catch(n){}}if(o&&o.notifications){var m=[];for(var k=0,j=o.notifications.length;k<j;k++){if(typeof o.notifications[k]==="object"){switch(typeof o.notifications[k].data){case"object":m.push(o.notifications[k].data);break;case"string":try{var p=JSON.parse(o.notifications[k].data);if(typeof p==="object"){m.push(p)}else{}}catch(n){}break;default:break}}}d.triggerMulti(m)}else{}};c.handler=function(i){return d.handler(i)};a.on("notificationReceived",function(){setTimeout(e,0)});e()}})(window,document,cards);(function(e,f,a){var g;try{g=a._.bridge("Picker")}catch(b){return}if(!g.startRequest){return}var d=a.events(h);a.picker=d;function h(k,j,l){if(typeof k!=="string"){throw TypeError("picker url must be a string, got "+k)}switch(typeof j){case"function":caller=j;case"undefined":j={};case"object":break;default:throw TypeError("picker options must be an object if defined, got "+j)}if(typeof l!=="function"){throw TypeError("picker callback must be a function, got "+l)}g.startRequest({requestUrl:k,requestData:j},function(m){l(m&&m.responseData)})}if(g.getRequest&&g.completeRequest){var c,i;try{c=(a._.secondBatch?a._.firstBatch["Picker.getRequest"]:g.getRequest()).requestData}catch(b){}if(c&&f.referrer){i=!!(c&&c.kik&&(f.referrer.split("?")[0]==="https://kik.com/"));d.url=f.referrer;d.data=c;d.fromKik=i;d.reply=function(k){if(i&&k){k=a.kik._formatMessage(k)}try{g.completeRequest({responseData:k})}catch(j){}};d.cancel=function(){try{g.cancelRequest()}catch(j){}d.url=undefined;d.data=undefined;d.reply=undefined;d.cancel=undefined;d.trigger("cancel")}}else{}}else{}})(window,document,cards);(function(g,i,b){var j;try{j=b._.bridge("IAP")}catch(e){return}var h,c;try{h=j.getAvailableItems().items;c=j.getTransactionList().transactions}catch(e){}if(!h||!c||!j.purchase||!j.markTransactionStored){return}var d=b.events(a);d.complete=f;d.items=h;d.pending=c;b.purchase=d;function a(k,l,m){if((typeof k!=="object")||(typeof k.sku!=="string")){throw TypeError("purchase item must be a valid item, got "+k)}switch(typeof l){case"function":m=l;l=undefined;case"undefined":l={};case"object":break;default:throw TypeError("purchase data must be a JSON object if defined, got "+l)}switch(typeof m){case"undefined":m=function(){};case"function":break;default:throw TypeError("purchase callback must be a function if defined, got "+m)}j.purchase({sku:k.sku,data:l},function(n){if(!n||!n.transaction){m();return}c.push(n.transaction);m(n.transaction)})}function f(l){if(typeof l!=="string"){throw TypeError("transactionId must be a string, got "+l)}j.markTransactionStored({transactionId:l});for(var k=c.length;k--;){if(c[k].transactionId===l){c.splice(k,1)}}}})(window,document,cards);(function(a){delete a._.firstBatch;if(a._.secondBatch){a._.bridge.batch(a._.secondBatch);delete a._.secondBatch}})(cards);cards.unsupported=function(l,m,b){var f="kik-prefer",n="kik-requires",j={metrics:function(){return h("Metrics")},"user-data":function(){return h("UserData")},photos:function(){return h("Photo")},};var i;e();k();return d;function e(){if(b.enabled){return}var q=b.utils.url,r="card"+q.updateQuery({kikme:null}).substr(4),p=!!q.query.kikme;if(!p){Array.prototype.forEach.call(m.getElementsByTagName("meta"),function(s){if((s.name===f)&&(s.content||"").trim()){p=true}})}if(p){b.open.card(r)}}function h(q){try{Plugin=b._.bridge(q);return !!Plugin}catch(p){return false}}function o(){var p;Array.prototype.forEach.call(m.getElementsByTagName("meta"),function(r){if(r.name===n){p=(r.content||"").trim()}});if(!p){return[]}var q=p.split(",").reduce(function(r,s){if((s=s.trim())&&(s in j)){r.push(s)}return r},[]);return q}function c(){var q=o(),p=true;q.forEach(function(r){if(!j[r]()){p=false}});return p}function k(){if(!c()){g();return true}}function g(){if(i){return}i=[];var s=m.documentElement;Array.prototype.forEach.call(s.childNodes,function(t){s.removeChild(t)});s.style.height="100%";s.style.width="100%";s.style.padding="0";s.style.border="none";s.style.margin="0";s.style.overflow="hidden";var p=m.createElement("head"),r=m.createElement("meta");r.name="viewport";r.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";p.appendChild(r);s.appendChild(p);var q=a();q.style.zIndex="99999999";q.style.position="fixed";q.style.top="0";q.style.left="0";q.style.height="100%";q.style.width="100%";q.style["-webkit-transform"]="translate3d(0,0,0)";s.appendChild(q);s.style.background=q.style.background}function d(s){var p=b.utils.platform.os.ios,q=b.utils.platform.os.android;switch(typeof s){case"undefined":s=function(){};case"function":break;default:throw TypeError("callback must be a function, got "+s)}if(i){i.push(s);return}i=[s];var r=a(function(){if(p){r.style["-webkit-transform"]="translate3d(0,100%,0)";r.style.transform="translate3d(0,100%,0)"}else{r.style["-webkit-transform"]="translate3d(100%,0,0)";r.style.transform="translate3d(100%,0,0)"}setTimeout(function(){m.documentElement.removeChild(r)},500);var t=i.slice();i=null;t.forEach(function(u){try{u()}catch(v){b.utils.error(v)}})});r.style.zIndex="99999999";r.style.position="fixed";r.style.top="0";r.style.left="0";r.style.height="100%";r.style.width="100%";if(p){r.style["-webkit-transform"]="translate3d(0,100%,0)";r.style.transform="translate3d(0,100%,0)"}else{r.style["-webkit-transform"]="translate3d(100%,0,0)";r.style.transform="translate3d(100%,0,0)"}m.documentElement.appendChild(r);setTimeout(function(){r.style["-webkit-transition"]="-webkit-transform 0.3s ease-in-out";r.style.transition="transform 0.3s ease-in-out";setTimeout(function(){r.style["-webkit-transform"]="translate3d(0,0,0)";r.style.transform="translate3d(0,0,0)"},0)},0)}function a(w){var q=b.utils.platform.os.ios,t=b.utils.platform.os.android;var p=m.createElement("div");p.style.background="#F3F3F3";if(t){p.style.fontFamily='"Roboto", sans-serif'}else{p.style.fontFamily='"Helvetica Neue", Helvetica, Arial, sans-serif'}var v=m.createElement("div");v.textContent="Please update Kik";v.style.padding="16px 0";v.style.margin="0 32px 16px";v.style.borderBottom="1px solid #CCC";v.style.color="#575";v.style.fontSize="24px";v.style.fontWeight="bold";v.style.textAlign="center";if(q){v.style["text-shadow"]="0 1px 0 #FFF"}p.appendChild(v);var r=m.createElement("a");r.textContent="Update";if(q){r.href="itms-apps://itunes.apple.com/app/kik-messenger/id357218860"}else{r.href="market://details?id=kik.android"}r.style.display="block";r.style.margin="0 48px";r.style.padding="8px 0";r.style.background="#CFC";r.style.border="1px solid #AFA";if(q){r.style["-webkit-border-radius"]="3px";r.style["border-radius"]="3px"}r.style.color="#686";r.style.fontSize="20px";r.style.fontWeight="bold";r.style.textAlign="center";r.style.textDecoration="none";p.appendChild(r);if(w){var s=m.createElement("div");if(typeof l.Clickable==="function"){l.Clickable(s)}s.textContent="Back";s.style.display="block";s.style.margin="16px 48px 0";s.style.padding="8px 0";s.style.background="#FCC";s.style.border="1px solid #FAA";if(q){s.style["-webkit-border-radius"]="3px";s.style["border-radius"]="3px"}s.style.color="#866";s.style.fontSize="20px";s.style.fontWeight="bold";s.style.textAlign="center";s.style.textDecoration="none";s.addEventListener("click",function(){if(w){w();w=null}},false);p.appendChild(s)}var u=m.createElement("div");u.textContent="This card needs some of Kik's new features to run properly. Update Kik to use this card and get those awesome features!";u.style.margin="16px 48px";u.style.padding="12px 16px";u.style.background="#FFF";u.style.border="1px solid #CCC";if(q){u.style["-webkit-border-radius"]="3px";u.style["border-radius"]="3px"}u.style.color="#777";u.style.fontSize="14px";p.appendChild(u);return p}}(window,document,cards);